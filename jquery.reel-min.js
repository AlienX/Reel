/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-11-09

 Requires jQuery 1.4.2 or higher
*/
jQuery.reel||function(i,nb,ma,r){function C(g){return i.reel.instances.length?i.reel.instances.first().data(g):null}function ob(g){return i.reel.instances.push(g[0])&&g}function pb(g){return(i.reel.instances=i.reel.instances.not("#"+g.attr(Q)))&&g}function na(g){return qb&&"data:image/gif;base64,R0lGODlh"+g}function rb(g){return"<"+g+"/>"}function oa(g){return"."+g}function pa(g){return"http://code.vostrel.cz/"+g}function qa(g){return"url("+g+")"}function J(g,a,m){return R(g,Na(a,m))}function sb(g){function a(){i.fn[this]||
(i.fn[this]=function(){return this})}i.each(g,a)}function ra(g,a){return x(g)*(a?-1:1)}function X(g){return g.originalEvent.touches[0]}i.reel={version:"1.1.3-devel",def:{footage:6,frame:1,frames:36,hint:"",horizontal:true,hotspot:r,indicator:0,klass:"",loops:true,reversed:r,spacing:0,stitched:0,suffix:"-reel",tooltip:"",area:r,brake:0.5,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,entry:r,graph:r,image:r,images:[],inversed:false,laziness:6,monitor:r,opening:0,orbital:0,path:"",
preloader:4,rebound:0.5,revolution:r,row:1,rows:0,speed:0,step:r,steps:r,tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,attr:{},scrollable:true,velocity:0}};i.fn.reel=function(g){var a=i.extend({},i.reel.def,g);g=function(f){var p=[];f.filter(tb).each(function(){var d=i(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(Oa),u=Y(a.attr.width||d.css(Pa)),l=Y(a.attr.height||d.css(Qa));!c||c==Ra||!u||!l||p.push(d)});f.filter(oa(y)).each(function(){p.push(i(this).trigger("teardown"))});
return i(p)}(this);var m=[];a.reversed&&(a.cw=true);a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);g.each(function(){var f=i(this),p=f.data(),d=function(h,b){p[h]=b;f.trigger("store",[h,b]);return b},c=function(h){var b=p[h];f.trigger("recall",[h,b]);return b},u={setup:function(h){if(f.hasClass(y))return l.call(h);var b=f.attr(a.attr).attr(Oa),e=d(Q,f.attr(Q)||f.attr(Q,y+"-"+ +new Date).attr(Q)),k=f.attr("style"),j=i.extend({},f.data()),n=a.images,o=a.stitched,q=a.loops,s={x:Y(f.css(Pa)||
a.attr.width),y:Y(f.css(Qa)||a.attr.height)},z=d(Z,a.orbital&&a.footage||a.rows<=1&&n.length||a.frames),A=o?1:Sa(z/a.footage),S={display:"block",width:s.x,height:s.y};e="#"+e+a.suffix;var Ta=f.attr("class")||"",sa={position:"relative",width:s.x,height:s.y};sa=i(T,{id:e.substr(1),"class":Ta+ta+ub,css:sa}).bind("openingDone",Ua);S=f.wrap(sa).attr({"class":y}).css(S).bind(u);m.push(ob(S)[0]);d(Va,n.length&&n.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(Wa,[]);d(D,a.frame);
d(Xa,a.spacing);d(K,s);d(t,0);d(ua,a.steps||a.frames);d($,a.revolution||o/2||s.x*2);d(va,A);d(aa,1/(z-(q&&!o?0:1)));d(vb,1/R(z,c(ua)));d(wa,o);d(Ya,o-(q?0:s.x));d(ba,e);d(G,d(xa,a.speed)<0);d(L,a.velocity||0);d(M,a.vertical);d(B,(a.row-1)/(a.rows-1));d(ca,ra(1,!a.cw&&!o));d(U,false);d(Za,a.brake);d(ya,!!a.orbital);d(E,a.tempo/(i.reel.lazy?a.laziness:1));d(da,0);d($a,{src:b,classes:Ta,style:k||Ra,data:j});F.bind(H,u.tick);l.call(h);f.trigger("start")},teardown:function(h){var b=f.data($a);f.parent().unbind("openingDone",
Ua).children("img").unbind(v);f.unbind(v).unbind(u).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(y);f.data(b.data).siblings().remove();f.unwrap();pb(f);ea();F.unbind(H,u.tick).unbind(H,u.opening_tick);fa.unbind(za).unbind(Aa);l.call(h)},start:function(){var h=c(K),b=c(Z),e=R(b,c(ua));e=d(t,1/e*((a.step||a.frame)-1));d(D,I(e*b)+1);f.attr("id");b=f.parent();e=i(T,{"class":wb,css:{position:ga,left:0,top:0,width:h.x,height:h.y,background:Ba,opacity:0}}).appendTo(b);var k=!c(U)||a.rows<=
1||!a.orbital||a.scrollable;e=d(ab,i(a.area||e));if(i.reel.touchy){f.css({WebkitUserSelect:"none",WebkitBackgroundSize:a.images.length?"auto":c(wa)&&c(wa)+"px "+h.y+"px"||h.x*a.footage+"px "+h.y*c(va)*(a.rows||1)*(a.directional?2:1)+"px"});e.bind(xb,function(j){f.trigger("down",[X(j).clientX,X(j).clientY,true])}).bind(yb,function(j){f.trigger("pan",[X(j).clientX,X(j).clientY,true]);return!k}).bind(zb,function(){f.trigger("up",[true]);return false}).bind(Ab,function(){f.trigger("up",[true]);return false})}else e.css({cursor:"url("+
bb+"), "+Ca}).bind(a.wheelable?Bb:"",function(j,n){f.trigger("wheel",[n]);return false}).bind(Cb,function(){f.trigger("play")}).bind(a.clickfree?Db:Eb,function(j){if(j.which==1){f.trigger("down",[j.clientX,j.clientY]);return false}}).bind(a.clickfree?Fb:"",function(){f.trigger("up");return false}).disableTextSelect();a.hint&&e.attr(Gb,a.hint);a.monitor&&b.append(Da=i(T,{"class":Hb,css:{position:ga,left:0,top:0}}))||(Da=i());a.indicator&&b.append(cb("x"));a.rows>1&&a.indicator&&b.append(cb("y"));f.trigger("preload")},
preload:function(h){var b=c(K),e=f.parent(),k=c(Va),j=a.images,n=!j.length?[k]:i.reel.math.spread(j,a,c),o=[],q=f[0];q.frames=n.length;q.preloaded=0;f.trigger("stop");for(e.append(Ea=i(T,{"class":Ib,css:{position:ga,left:0,top:b.y-a.preloader,height:a.preloader,overflow:db,backgroundColor:Ba}}));n.length;){var s=a.path+n.shift(),z=i(new Image).hide().bind("load"+v,function(){q.preloaded++;i(this).unbind(v);Ea.css({width:1/q.frames*q.preloaded*b.x});if(q.frames==q.preloaded){Ea.remove();j.length||
f.attr({src:Jb}).css({backgroundImage:qa(a.path+k)});f.trigger(a.rows>1&&!a.stitched?"rowChange":"frameChange").trigger("loaded").trigger("opening");l.call(h)}});e.append(z);o.push(s);setTimeout(function(A,S){return function(){A.attr({src:S})}}(z,s),0)}d(Wa,o)},tick:function(h){var b=c(L);if(V){var e=b-c(Za)/C(E)*V;b=!(b*e<=0||b<x(e))&&d(L,b>x(c(xa))?e:(V=w=0))}Da.text(c(a.monitor));b&&V++;w&&w++;eb(0);Fa=true;if(w&&!b)return l.call(h);if(c(ha))return l.call(h,N());e=c(ca)*ra(1,c(G));var k=(c(Ga)?
b:x(c(xa))+b)/C(E);b=c(t);e=d(t,b-k*e);l.call(h);e!=b&&f.trigger("fractionChange")},opening:function(){var h=a.entry||a.speed,b=c(t),e=a.opening;d(t,b-h*a.opening);d(da,e*C(E));F.bind(H,u.opening_tick)},opening_tick:function(h){var b=(a.entry||a.speed)/C(E)*(a.cw?-1:1),e=c(t);d(t,e+b);b=d(da,c(da)-1);f.trigger("fractionChange");l.call(h);if(!(b>1)){F.unbind(H,u.opening_tick);f.trigger("openingDone")}},play:function(h){var b=d(Ha,true);d(Ga,!b);fb();l.call(h)},pause:function(h){d(Ha,false);N();l.call(h)},
stop:function(h){var b=d(Ga,true);d(Ha,!b);l.call(h)},down:function(h,b,e,k){if(a.draggable){d(ha,c(D));d(L,0);ia=ja(b,e,c(t),c($),c(B));N();ea();if(!k){fa.css({cursor:qa(Kb)+", "+Ca}).bind(Aa,function(j){f.trigger("pan",[j.clientX,j.clientY]);l.call(j);return false});a.clickfree||fa.bind(za,function(j){f.trigger("up");l.call(j)})}}l.call(h)},up:function(h,b){if(!a.draggable)return l.call(h);d(ha,false);d(U,false);var e=d(L,!a.throwable?0:x(W[0]+W[1])/60);V=e?1:0;e?fb():N();ea();!b&&fa.unbind(za).unbind(Aa)&&
c(ab).css({cursor:qa(bb)+", "+Ca});l.call(h)},pan:function(h,b,e){if(a.draggable&&Fa){Fa=false;N();var k={x:b-ia.x,y:e-ia.y};if(x(k.x)>0||x(k.y)>0){ia={x:b,y:e};var j=c($),n=c(gb),o=c(M),q=d(t,hb(o?e-n.y:b-n.x,c(Ia),j,c(Ja),c(Ka),c(ca)));d(U,c(U)||c(D)!=c(ha));(k=eb(o?k.y:k.x||0))&&d(G,k<0);if(a.orbital&&c(ya)){d(M,x(e-n.y)>x(b-n.x));n=ja(b,e,q,j,c(B))}if(a.rows>1){k=c(K).y;o=c(ib);var s=-o*k;d(B,i.reel.math.envelope(e-n.y,o,k,s,s+k,-1))}!(q%1)&&!a.loops&&ja(b,e,q,j,c(B));f.trigger("fractionChange")}}l.call(h)},
wheel:function(h,b){var e=Sa(Lb(x(b))/2);e=ra(e,b>0);b=0.2*c($);ja(r,r,c(t),b,c(B));d(t,hb(e,c(Ia),b,c(Ja),c(Ka),c(ca)));e&&d(G,e<0);d(L,0);N();l.call(h);f.trigger("fractionChange");return false},fractionChange:function(h,b){b=d(t,ka.fraction(b,a,c));var e=d(D,1+O(b/c(aa))),k=a.rows>1,j=a.orbital;d(ya,!!j&&(e<=j||e>=a.footage-j+2));if(!a.loops&&a.rebound){!w&&!(b%1)?La++:(La=0);La>=a.rebound*1E3/C(E)&&d(G,!c(G))}f.trigger(k?"rowChange":"frameChange");l.call(h)},rowChange:function(h,b){var e=c(t)/
c(aa)+1;b=d(B,ka.row(b,a,c));b=J(0,a.rows-1,O(b*a.rows));d(D,O(e+b*a.frames));l.call(h);f.trigger("frameChange")},frameChange:function(h,b){var e=d(t,ka.fraction(!b?r:c(aa)*(b-1),a,c)),k=c(jb);b=d(jb,d(D,ka.frame(b,a,c)));var j=a.images,n=a.footage,o=c(K),q=a.rows>1,s=a.horizontal;if(c(M)){b=a.inversed?n+1-b:b;b+=n}var z=(c(M)?o.y:o.x)-a.indicator,A=J(0,z,I(i.reel.math.interpolate(c(t),-1,z+2)));A=!a.cw||a.stitched?A:z-A;i(oa(Ma+".x"),c(ba)).css(c(M)?{left:0,top:A}:{left:A,top:o.y-a.indicator});if(q){q=
o.y-a.indicator;q=J(0,q,I(i.reel.math.interpolate(c(B),-1,q+2)));i(oa(Ma+".y"),c(ba)).css({top:q})}if(b!=k){i(c(ba)).removeClass(kb+k).addClass(kb+b);if(j.length)f.attr({src:a.path+j[b-1]});else{if(a.stitched)j=[-I(e*c(Ya))+P,0+P];else{e=b%n-1;e=e<0?n-1:e;n=O((b-0.1)/n);n+=a.rows>1?0:c(G)?0:c(va);b=c(Xa);n=n*((s?o.y:o.x)+b);o=e*((s?o.x:o.y)+b);j=j.length?[0,0]:s?[-o+P,-n+P]:[-n+P,-o+P]}f.css({backgroundPosition:j.join(ta)})}}l.call(h)}},l=function(h){lb||delete this;return h},w,V=0,fb=function(){return w=
0},N=function(){clearTimeout(mb);F.unbind(H,u.opening_tick);f.trigger("play");return w=-a.timeout*C(E)},mb,Ua=function(){mb=setTimeout(function(){f.trigger("play")},a.delay*1E3||0)},Da,Ea,cb=function(h){return i(T,{"class":[Ma,h].join(ta),css:{width:a.indicator,height:a.indicator,overflow:db,top:c(K).y-a.indicator,left:0,position:ga,backgroundColor:Ba}})},La=0,ia={x:0,y:0},eb=function(h){return W.push(h)&&W.shift()&&h},ea=function(){return W=[0,0]},W=ea(),hb=a.graph||i.reel.math[a.loops?"hatch":"envelope"],
ka=i.reel.normal,ja=function(h,b,e,k,j){d(Ia,e);d(ib,j);d(Ja,a.loops?0:-e*k);d(Ka,a.loops?k:k-e*k);return h&&d(gb,{x:h,y:b})||r},Fa=true,fa=i.browser.opera?F:i.unique(F.add(nb.top.document));u.setup()});la=la||function f(){var p=+new Date,d=C(E);if(d){F.trigger(H);i.reel.cost=(+new Date+i.reel.cost-p)/2;return la=setTimeout(f,R(4,1E3/d-i.reel.cost))}else return la=r}();return i(m)};i.reel.math={envelope:function(g,a,m,f,p,d){return a+R(f,Na(p,-g*d))/m},hatch:function(g,a,m,f,p,d){g=(g<f?p:0)+g%p;
g=a+-g*d/m;return g-O(g)},interpolate:function(g,a,m){return a+g*(m-a)},spread:function(g,a,m){function f(w){for(;!(w>=1&&w<=l);)w+=w<1?+l:-l;return d[w]||(d[w]=!!p.push(w))}var p=[],d=new Array(l),c=m(Z),u=a.orbital?2:a.rows||1;m=u*2;var l=c*u;u=(a.row-1)*c+a.frame;a=l/m;for(c=0;c<m;c++)f(u+I(c*a));for(;a>1;){c=0;m=p.length;for(a/=2;c<m;c++)f(I(p[c]+a))}for(c=0;c<p.length;c++)p[c]=g[p[c]-1];return p}};i.reel.normal={fraction:function(g,a,m){g=g!=r?g:m(t);return a.loops?g-O(g):J(0,1,g)},row:function(g,
a,m){return J(0,1,g!=r?(g-1)/(a.rows-1):m(B))},frame:function(g,a,m){g=I(g)||m(D);for(m=m(Z)*(a.orbital?2:a.rows||1);g<1;)g+=m;return a.loops?g%m:J(0,m,g)}};i.reel.touchy=/iphone|ipod|ipad/i.test(navigator.userAgent);i.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);i.reel.instances=i();i.reel.cost=0;i.reel.leader=C;sb("mousewheel disableTextSelect enableTextSelect".split(/ /));var F=i(ma);ma=+i.browser.version.split(".").slice(0,2).join(".");var lb=i.browser.msie,qb=!(lb&&ma<8),Ca="ew-resize",
la,y="jquery-reel",ub=y+"-overlay",Ma=y+"-indicator",Ib=y+"-preloader",Hb=y+"-monitor",wb=y+"-interface",kb="frame-",Jb=na("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||pa("blank.gif"),bb=na("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAI3lC8AeBDvgosQxQtne7yvLWGStVBelXBKqDJpNzLKq3xWBlU2nUs4C/O8cCvU0EfZGUwt19FYAAA7")||pa("jquery.reel.cursor-drag.gif"),Kb=na("EAAQAJECAAAAAP///////wAAACH5BAEAAAIALAAAAAAQABAAQAIslI95EB3MHECxNjBVdE/5b2zcRV1QBabqhwltq41St4hj5konmVioZ6OtEgUAOw==")||pa("jquery.reel.cursor-drag-down.gif"),
I=Math.round,O=Math.floor,Sa=Math.ceil,Na=Math.min,R=Math.max,x=Math.abs,Lb=Math.sqrt,Y=parseInt,ab="area",$a="backup",G="backwards",aa="bit",Za="brake",ya="center",ha="clicked",gb="clicked_location",Ia="clicked_on",ib="clicked_row",ca="cwish",K="dimensions",t="fraction",D="frame",jb="_frame",Z="frames",Ka="hi",db="hidden",Va="image",Wa="images",da="opening_ticks",Ja="lo",Ha="playing",U="reeling",$="revolution",B="row",va="rows",Xa="spacing",xa="speed",ba="stage",ua="steps",wa="stitched",Ya="stitched_travel",
Ga="stopped",E="tempo",L="velocity",M="vertical",vb="wheel_step",v=".reel",Cb="dblclick"+v,Eb="mousedown"+v,Db="mouseenter"+v,Fb="mouseleave"+v,Aa="mousemove"+v,za="mouseup"+v,Bb="mousewheel"+v,H="tick"+v,Ab="touchcancel"+v,zb="touchend"+v,xb="touchstart"+v,yb="touchmove"+v,Ra="",ta=" ",ga="absolute",T=rb("div"),Qa="height",Ba="#000",Q="id",tb="img",P="px",Oa="src",Gb="title",Pa="width"}(jQuery,window,document);
