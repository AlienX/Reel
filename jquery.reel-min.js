/*
 Copyright (c) 2009-2011 Petr Vostrel (http://petr.vostrel.cz/)
 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 jQuery Reel
 http://jquery.vostrel.cz/reel
 Version: 1.1.3-devel
 Updated: 2011-12-23

 Requires jQuery 1.4.3 or higher
*/
jQuery.reel||function(g,Ab,Da,p){function L(e){return g.reel.instances.length?g.reel.instances.first().data(e):null}function Bb(e){return g.reel.instances.push(e[0])&&e}function Cb(e){return(g.reel.instances=g.reel.instances.not(ca(e.attr(da))))&&e}function Db(e){return"data:image/gif;base64,R0lGODlh"+e}function Ea(e){return"<"+e+"/>"}function x(e){return"."+e}function ma(e){return g.reel.cdn+e}function na(e){return"url("+e+")"}function T(e,a,n){return ea(e,ab(a,n))}function Eb(e){function a(){g.fn[this]||
(g.fn[this]=function(){return this})}g.each(e,a)}function Fa(e,a){return E(e)*(a?-1:1)}function oa(e){return e.originalEvent.touches[0]}function Ga(e){return e===p||typeof e=="string"?e:e+"px"}function ca(e){return"#"+e}function Fb(e){var a=[];g.each(e,function(n,h){a.push(n.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+Ga(h))});return"{"+a.join(";")+";}"}function Gb(){var e=g().jquery.split(".");if(e=+e[0]<=1&&(+e[1]<4||+e[1]==4&&+e[2]<3))try{console.error("FATAL: jQuery Reel plug-in requires at least jQuery 1.4.3")}catch(a){}return e}
if(!Gb()){g.reel={version:"1.1.3-devel",def:{area:p,brake:0.23,clickfree:false,cw:false,delay:-1,directional:false,draggable:true,footage:6,entry:p,frame:1,frames:36,graph:p,hint:"",horizontal:true,image:p,images:[],indicator:0,inversed:false,klass:"",laziness:6,loops:true,monitor:p,opening:0,orbital:0,path:"",preloader:4,rebound:0.5,revolution:p,row:1,rows:0,spacing:0,speed:0,step:p,steps:p,stitched:0,suffix:"-reel",tempo:36,timeout:2,throwable:true,vertical:false,wheelable:true,annotations:p,attr:{},
cursor:p,preload:"fidelity",scrollable:true,steppable:true,velocity:0}};g.fn.reel=function(e){var a=g.extend({},g.reel.def,e);e=function(h){var t=[];h.filter(Ha).each(function(){var d=g(this),c=a.images.length&&a.images||a.image||a.attr.src||d.attr(bb),z=pa(a.attr.width||d.css(cb)),o=pa(a.attr.height||d.css(db));!c||c==qa||!z||!o||t.push(d)});h.filter(x(v)).each(function(){t.push(g(this).unreel())});return g(t)}(this);var n=[];a.tooltip&&(a.hint=a.tooltip);a.hotspot&&(a.area=a.hotspot);e.each(function(){var h=
g(this),t=h.data(),d=function(i,b){t[i]=b;h.trigger("store",[i,b]);return b},c=function(i){var b=t[i];h.trigger("recall",[i,b]);return b},z={setup:function(i){if(h.hasClass(v))return o.call(i);var b=h.attr(a.attr).attr(bb),f=d(da,h.attr(da)||h.attr(da,v+"-"+ +new Date).attr(da)),j=h.attr("style"),l=g.extend({},h.data()),m=a.images,k=a.stitched,r=a.loops,A={x:pa(h.css(cb)||a.attr.width),y:pa(h.css(db)||a.attr.height)},s=d(F,a.frame),U=d(ra,a.orbital&&a.footage||a.rows<=1&&m.length||a.frames),V=k?1:
eb(U/a.footage);f=ca(f+a.suffix);var sa=h.attr("class")||"";s=g(fa,{id:f.substr(1),"class":sa+G+Hb+G+fb+s});s=h.wrap(s.addClass(a.klass)).attr({"class":v});n.push(Bb(s)[0]);s=s.parent().bind(z.instance);d(gb,m.length&&m.length||a.image||b.replace(/^(.*)\.(jpg|jpeg|png|gif)$/,"$1"+a.suffix+".$2"));d(hb,[]);d(F,a.frame);d(Ia,0);d(ib,a.spacing);d(M,A);d(q,0);d(Ja,a.steps||a.frames);d(ta,a.revolution||k/2||A.x*2);d(Ka,V);d(W,1/(U-(r&&!k?0:1)));d(Ib,1/ea(U,c(Ja)));d(La,k);d(jb,k-(r?0:A.x));d(Ma,f);d(J,
d(ga,a.speed)<0);d(X,a.velocity||0);d(Y,a.vertical);d(K,(a.row-1)/(a.rows-1));d(Z,Fa(1,!a.cw&&!k));d(ha,false);d(kb,a.brake);d(Na,!!a.orbital);d(N,a.tempo/(g.reel.lazy?a.laziness:1));d(Q,-1);d(Oa,a.annotations)||s.unbind(".annotations");d(lb,{src:b,classes:sa,style:j||qa,data:l});a.steppable||s.unbind("click.steppable");B(true,qa,{width:A.x,height:A.y,overflow:Pa});B(true,","+G+x(v),{display:"block",position:"relative"});O.bind(z.pool);o.call(i);h.trigger("setup")},instance:{teardown:function(i){var b=
h.data(lb);h.parent().unbind(z.instance).children(Ha).unbind(w);c(mb).remove();h.unbind(w).attr({"class":b.classes,src:b.src,style:b.style}).removeClass(v);h.data(b.data).siblings().remove();h.unwrap();Cb(h);ua();O.unbind(z.pool);$.unbind(Qa).unbind(Ra);o.call(i)},setup:function(){var i=c(M),b=c(ra),f=ea(b,c(Ja));f=d(q,1/f*((a.step||a.frame)-1));d(F,R(f*b)+1);h.attr("id");b=h.parent();var j=!c(ha)||a.rows<=1||!a.orbital||a.scrollable;f=d(Jb,g(a.area||b));if(g.reel.touchy){B(true,G+x(v),{WebkitUserSelect:"none",
WebkitBackgroundSize:a.images.length?"auto":c(La)&&c(La)+"px "+i.y+"px"||i.x*a.footage+"px "+i.y*c(Ka)*(a.rows||1)*(a.directional?2:1)+"px"});f.bind(Kb,function(k){h.trigger("down",[oa(k).clientX,oa(k).clientY,true])}).bind(Lb,function(k){h.trigger("pan",[oa(k).clientX,oa(k).clientY,true]);return!j}).bind(Mb,function(){h.trigger("up",[true]);return false}).bind(Nb,function(){h.trigger("up",[true]);return false})}else{var l=a.cursor=="hand"?na(Ob)+","+Sa:a.cursor||na(Pb)+","+Sa,m=a.cursor=="hand"?
na(Qb)+","+Sa+" !important":false;B(true,qa,{cursor:l});B(true,x(Ta),{cursor:Rb});m&&B(false,x(va)+", "+x(va)+" *",{cursor:m});f.bind(a.wheelable?Sb:"",function(k,r){h.trigger("wheel",[r]);return false}).bind(a.clickfree?Tb:Ub,function(k){if(!(Vb?!k.button:!!k.button)){h.trigger("down",[k.clientX,k.clientY]);return false}}).bind(a.clickfree?Wb:"",function(){h.trigger("up");return false}).disableTextSelect()}a.hint&&f.attr(Xb,a.hint);a.monitor&&b.append(u=g(fa,{"class":nb}))||(u=g());B(true,G+x(nb),
{position:wa,left:0,top:0});B(true,G+x(ob),{display:"none"});B(true,G+x(pb),{position:wa,left:0,top:i.y-a.preloader,height:a.preloader,overflow:Pa,backgroundColor:qb});a.indicator&&b.append(rb("x"));a.rows>1&&a.indicator&&b.append(rb("y"))},preload:function(i){var b=c(M),f=h.parent(),j=c(gb),l=a.images,m=!l.length,k=c(ra),r=g.reel.preload[a.preload]||g.reel.preload[g.reel.def.preload];r=m?[j]:r(l,a,c);var A=[],s=h[0];s.frames=r.length;s.preloaded=0;f.addClass(Ta).append(C=g(fa,{"class":pb}));for(h.trigger("stop");r.length;){var U=
a.path+r.shift(),V=b.x*(!m?1:a.footage),sa=b.y*(!m?1:k/a.footage)*(!a.directional?1:2);V=g(new Image).addClass(ob).attr({width:V,height:sa}).bind("load"+w,function(){s.preloaded++;g(this).unbind(w);C.css({width:1/s.frames*s.preloaded*b.x});if(s.frames==s.preloaded){C.remove();l.length||h.css({backgroundImage:na(a.path+j)}).attr({src:Yb});f.removeClass(Ta);h.trigger("loaded");o.call(i)}});f.append(V);A.push(U);setTimeout(function(Zb,$b){return function(){Zb.attr({src:$b})}}(V,U),0)}d(hb,A);d(mb,g('<style type="text/css">'+
sb.join("\n")+"</style>").prependTo("head"))},opening:function(){if(!a.opening)return h.trigger("openingDone");var i=a.entry||a.speed,b=c(q),f=a.opening;d(q,b-i*a.opening);d(Q,f*L(N))},openingDone:function(){S=setTimeout(function(){h.trigger("play")},a.delay*1E3||0)},play:function(i,b){b=d(ga,b||c(ga));b=d(Ua,!!b);d(Va,!b);H();o.call(i)},pause:function(i){d(Ua,false);y();o.call(i)},stop:function(i){var b=d(Va,true);d(Ua,!b);o.call(i)},down:function(i,b,f,j){if(a.draggable){d(xa,c(F));d(X,0);ya=za(b,
f,c(q),c(ta),c(K));y();ua();ia=false;tb.addClass(va);if(!j){$.bind(Ra,function(l){h.trigger("pan",[l.clientX,l.clientY]);o.call(l);return false});a.clickfree||$.bind(Qa,function(l){h.trigger("up");o.call(l)})}}o.call(i)},up:function(i,b){if(!a.draggable)return o.call(i);d(xa,false);d(ha,false);var f=d(X,!a.throwable?0:E(ja[0]+ja[1])/60);P=f?1:0;f?H():y();ua();tb.removeClass(va);!b&&$.unbind(Qa).unbind(Ra);o.call(i)},pan:function(i,b,f){if(a.draggable&&Wa){Wa=false;y();var j={x:b-ya.x,y:f-ya.y};if(E(j.x)>
0||E(j.y)>0){ia=true;ya={x:b,y:f};var l=c(ta),m=c(ub),k=c(Y),r=d(q,vb(k?f-m.y:b-m.x,c(Xa),l,c(Ya),c(Za),c(Z)));d(ha,c(ha)||c(F)!=c(xa));(j=wb(k?j.y:j.x||0))&&d(J,j<0);if(a.orbital&&c(Na)){d(Y,E(f-m.y)>E(b-m.x));m=za(b,f,r,l,c(K))}if(a.rows>1){j=c(M).y;k=c(xb);var A=-k*j;d(K,g.reel.math.envelope(f-m.y,k,j,A,A+j,-1))}!(r%1)&&!a.loops&&za(b,f,r,l,c(K));h.trigger("fractionChange")}}o.call(i)},wheel:function(i,b){var f=eb(ac(E(b))/2);f=Fa(f,b>0);b=0.0833*c(ta);za(p,p,c(q),b,c(K));d(q,vb(f,c(Xa),b,c(Ya),
c(Za),c(Z)));f&&d(J,f<0);d(X,0);y();o.call(i);h.trigger("fractionChange");return false},fractionChange:function(i,b){b=d(q,Aa.fraction(b,a,c));var f=d(F,1+aa(b/c(W))),j=a.rows>1,l=a.orbital;d(Na,!!l&&(f<=l||f>=a.footage-l+2));if(!a.loops&&a.rebound){!I&&!(b%1)?$a++:($a=0);$a>=a.rebound*1E3/L(N)&&d(J,!c(J))}h.trigger(j?"rowChange":"frameChange");o.call(i)},rowChange:function(i,b){var f=c(q)/c(W)+1;b=d(K,Aa.row(b,a,c));b=T(0,a.rows-1,aa(b*a.rows));d(F,aa(f+b*a.frames));o.call(i);h.trigger("frameChange")},
frameChange:function(i,b){var f=d(q,Aa.fraction(!b?p:c(W)*(b-1),a,c));b=Aa.frame(b,a,c);var j=a.footage;if(c(Y)){b=a.inversed?j+1-b:b;b+=j}if(b==c(Ia))D(i);else{var l=a.horizontal,m=a.images,k=c(M);b=d(Ia,d(F,b));if(m.length)h.attr({src:a.path+m[b-1]});else{if(a.stitched)k=[-R(f*c(jb))+ba,0+ba];else{f=b%j-1;f=f<0?j-1:f;j=aa((b-0.1)/j);j+=a.rows>1?0:c(J)?0:c(Ka);b=c(ib);j=j*((l?k.y:k.x)+b);k=f*((l?k.x:k.y)+b);k=m.length?[0,0]:l?[-k+ba,-j+ba]:[-j+ba,-k+ba]}h.css({backgroundPosition:k.join(G)})}}if(a.indicator){l=
c(Ma);m=a.rows>1;k=c(M);f=(c(Y)?k.y:k.x)-a.indicator;b=T(0,f,R(g.reel.math.interpolate(c(q),-1,f+2)));b=!a.cw||a.stitched?b:f-b;g(x(Ba+".x"),l).css(c(Y)?{left:0,top:b}:{left:b,top:k.y-a.indicator});if(m){k=k.y-a.indicator;k=T(0,k,R(g.reel.math.interpolate(c(K),-1,k+2)));g(x(Ba+".y"),l).css({top:k})}}o.call(i)},stepLeft:function(){y();d(J,false);h.trigger("fractionChange",c(q)-c(W)*c(Z))},stepRight:function(){y();d(J,true);h.trigger("fractionChange",c(q)+c(W)*c(Z))},"click.steppable":function(i){if(ia)return D(i);
h.trigger(i.clientX-h.offset().left>0.5*c(M).x?"stepRight":"stepLeft")},"setup.annotations":function(){c(M);var i=h.parent();g.each(c(Oa),function(b,f){var j=g(fa,f.node).attr({id:b}).addClass(bc),l=f.image?g(Ea(Ha),f.image):g(),m=f.link?g(Ea(cc),f.link):g();B(false,ca(b),{display:"none",position:wa});m.bind({"click.annotations":function(k){k.stopPropagation()}});f.image||f.link&&j.append(m);f.link||f.image&&j.append(l);f.link&&f.image&&j.append(m.append(l));j.appendTo(i)});h.trigger("frameChange.annotations")},
"frameChange.annotations":function(i,b){b=b||c(F);this.className=this.className.replace(/frame-\d+/,fb+b);g.each(c(Oa),function(f,j){f=g(ca(f));var l=j.start,m=j.end,k=b-(l||1),r=typeof j.x!=yb?j.x:j.x[k];j=typeof j.y!=yb?j.y:j.y[k];j={display:r!==p&&j!==p&&k>=0&&(!m||k<=m-l)?"block":"none",left:Ga(r)||0,top:Ga(j)||0};f.css(j)})},"setup.fu":function(){h.trigger("preload")},"loaded.fu":function(){h.trigger("opening")}},pool:{"tick.reel":function(i){var b=c(X);if(P){var f=b-c(kb)/L(N)*P;b=!(b*f<=0||
b<E(f))&&d(X,b>E(c(ga))?f:(P=I=0))}u.text(c(a.monitor));b&&P++;I&&I++;wb(0);Wa=true;if(I&&!b)return D(i);if(c(xa))return D(i,y());if(!(c(Q)>0)){f=c(Z)*Fa(1,c(J));b=(c(Va)?b:E(c(ga))+b)/L(N);var j=c(q);d(q,j-b*f);o.call(i)}},"tick.reel.opening":function(i){if(a.opening){if(c(Q)<=0)return;var b=(a.entry||a.speed)/L(N)*(a.cw?-1:1),f=c(q);d(q,f+b);b=d(Q,c(Q)-1);o.call(i);if(b>0)return;h.trigger("openingDone")}O.unbind(ka+".opening",z.pool[ka+".opening"])},"tick.reel.fu":function(){h.trigger("fractionChange")}}},
o=function(i){zb||delete this;return i},D=function(i,b){return i.stopImmediatePropagation()||o.call(i)||b},I,P=0,H=function(){return I=0},y=function(){clearTimeout(S);O.unbind(ka+".opening",z.pool[ka+".opening"]);d(Q,0);setTimeout(function(){h.trigger("play")},0);return I=-a.timeout*L(N)},ia=false,S,u,C,rb=function(i){B(true,G+x(Ba)+x(i),{position:wa,width:a.indicator,height:a.indicator,overflow:Pa,backgroundColor:qb});return g(fa,{"class":[Ba,i].join(G)})},sb=[],B=function(i,b,f){var j=c(Ma);b=b.split(",");
i&&g.each(b,function(l,m){b[l]=j+m});sb.push(b.join(",")+Fb(f));return f},$a=0,ya={x:0,y:0},wb=function(i){return ja.push(i)&&ja.shift()&&i},ua=function(){return ja=[0,0]},ja=ua(),vb=a.graph||g.reel.math[a.loops?"hatch":"envelope"],Aa=g.reel.normal,za=function(i,b,f,j,l){d(Xa,f);d(xb,l);d(Ya,a.loops?0:-f*j);d(Za,a.loops?j:j-f*j);return i&&d(ub,{x:i,y:b})||p},Wa=true,$;try{$=g.browser.opera?O:g.unique(O.add(Ab.top.document))}catch(dc){$=O}z.setup()});Ca=Ca||function h(){var t=+new Date,d=L(N);if(d){O.trigger(ka);
g.reel.cost=(+new Date+g.reel.cost-t)/2;return Ca=setTimeout(h,ea(4,1E3/d-g.reel.cost))}else return Ca=p}();return g(n)};g.fn.unreel=function(){return this.trigger("teardown")};g.reel.math={envelope:function(e,a,n,h,t,d){return a+ea(h,ab(t,-e*d))/n},hatch:function(e,a,n,h,t,d){e=(e<h?t:0)+e%t;e=a+-e*d/n;return e-aa(e)},interpolate:function(e,a,n){return a+e*(n-a)}};g.reel.preload={linear:function(e){return e},fidelity:function(e,a){function n(o,D,I){function P(C){for(;!(C>=1&&C<=S);)C+=C<1?+S:-S;
return z[I+C]||(z[I+C]=!!H.push(C))}if(!o.length)return[];var H=[],y=4*D,ia=a.frame,S=o.length;D=S/y;for(var u=0;u<y;u++)P(ia+R(u*D));for(;D>1;){u=0;y=H.length;for(D/=2;u<y;u++)P(R(H[u]+D))}for(u=0;u<H.length;u++)H[u]=o[H[u]-1];return H}var h=a.orbital?2:a.rows||1,t=a.orbital?a.footage:a.frames,d=(a.row-1)*t,c=[].concat(e),z=new Array(e.length);e=h<2?[]:c.slice(d,d+t);return n(e,1,d).concat(n(c,h,0))}};g.reel.normal={fraction:function(e,a,n){e=e!=p?e:n(q);return a.loops?e-aa(e):T(0,1,e)},row:function(e,
a,n){return T(0,1,e!=p?(e-1)/(a.rows-1):n(K))},frame:function(e,a,n){e=e!=p?R(e):n(F);var h=a.orbital?2:a.rows||1;n=n(ra)*h;e=a.loops?e%n||n:T(1,n,e);return e<0?e+n:e}};g.reel.touchy=/iphone|ipod|ipad|android/i.test(navigator.userAgent);g.reel.lazy=/iphone|ipod|android/i.test(navigator.userAgent);g.reel.cdn="http://code.vostrel.cz/";g.reel.instances=g();g.reel.cost=0;g.reel.leader=L;Eb("mousewheel disableTextSelect enableTextSelect".split(/ /));var O=g(Da),tb=g("html");Da=+g.browser.version.split(".").slice(0,
2).join(".");var zb=g.browser.msie,la=navigator.userAgent;la={linux:/linux/i.test(la),windows:/windows/i.test(la),mac:/macintosh/i.test(la)};var Vb=zb&&Da<=8,Ca,v="reel",Hb=v+"-overlay",Ba=v+"-indicator",pb=v+"-preloader",ob=v+"-cached",nb=v+"-monitor",bc=v+"-annotation",va=v+"-panning",Ta=v+"-loading",fb="frame-",R=Math.round,aa=Math.floor,eb=Math.ceil,ab=Math.min,ea=Math.max,E=Math.abs,ac=Math.sqrt,pa=parseInt,Oa="annotations",Jb="area",lb="backup",J="backwards",W="bit",kb="brake",Na="center",xa=
"clicked",ub="clicked_location",Xa="clicked_on",xb="clicked_row",Z="cwish",M="dimensions",q="fraction",F="frame",Ia="_frame",ra="frames",Za="hi",Pa="hidden",gb="image",hb="images",Q="opening_ticks",Ya="lo",Ua="playing",ha="reeling",ta="revolution",K="row",Ka="rows",ib="spacing",ga="speed",Ma="stage",Ja="steps",La="stitched",jb="stitched_travel",Va="stopped",mb="style",N="tempo",X="velocity",Y="vertical",Ib="wheel_step",w=".reel",Ub="mousedown"+w,Tb="mouseenter"+w,Wb="mouseleave"+w,Ra="mousemove"+
w,Qa="mouseup"+w,Sb="mousewheel"+w,ka="tick"+w,Nb="touchcancel"+w,Mb="touchend"+w,Kb="touchstart"+w,Lb="touchmove"+w,qa="",G=" ",wa="absolute",cc="a",fa=Ea("div"),db="height",qb=ca("000"),da="id",Ha="img",Sa="move",yb="object",ba="px",bb="src",Xb="title",cb="width",Yb=Db("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7")||ma("blank.gif"),Rb="wait",Pb=ma("jquery.reel-"+(la.mac?"black":"white")+".cur"),Ob=ma("jquery.reel-drag.cur"),Qb=ma("jquery.reel-drag-down.cur")}}(jQuery,window,document);
